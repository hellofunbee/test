<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>物联网-综合信息-传感信息</title>
    <link rel="stylesheet" href="css/reset.min.css">
    <link rel="stylesheet" href="css/zTreeStyle/zTreeStyle.css">
    <link rel="stylesheet" href="css/style.css">

</head>

<body>
<div class="mx-main" page="synthesize">
    <div class="mx-handle clearfix">
        
        <div class="sblb fl">
            <h3>设备列表</h3>
            <div class="tree-cnt">
                <div class="tree-show">
                    <ul id="big_data_analysis_device_tree" class="ztree"></ul>
                </div>
            </div>
        </div>
        
        <div class="sm-title fl">
            传感信息
        </div>
        
        <div class="sblb fr">
            <h3>更多</h3>
            <div class="more-cnt more-cnt-lg">
                <div class="userInfo-more">
                    <p><span class="name">设备ID</span><span field="DeviceId">111.112.111.110</span></p>
                    <p><span class="name">所有者姓名</span><span field="name">无接口</span></p>
                    <p><span class="name">监管者姓名</span><span field="supervisername">地知道</span></p>
                    <p><span class="name">指导专家</span><span field="exportorname">不晓得</span></p>
                    <p><span class="name">状态</span><span field="state">运行中</span></p>
                </div>
            </div>
        </div>
        
        <div class="sm-userInfo fr synDeviceName">
            [21号] 李娜 土豆
        </div>
    </div>
    <div class="cgxx-module mt10">
        
        <div class="cgxx-tit">
            <h3>传感器信息</h3></div>
        <div class="cgxx-cnt">
            <ul class="cgq-list clearfix">
                
                <li>
                    <div class="sensorAnimation">
                        <img src="images/gz.png" alt="">
                    </div>
                    <p>光照度： 2000lux</p>
                </li>
                
                <li>
                    <div class="sensorAnimation">
                        <div class="eyht-box">
                            <img src="images/eyht.png" class="first">
                            <div class="middle" style="height:30px"></div>
                            <img src="images/eyht-bg.png" class="last">
                        </div>
                    </div>
                    <p>二氧化碳：341.2ppm</p>
                </li>
                
                <li>
                    <div class="sensorAnimation">
                        <div class="wdj-box">
                            <img src="images/wdj.png" class="first">
                            <div class="middle" style="height:40px"></div>
                            <img src="images/wdj-bg.png" class="last">
                        </div>
                    </div>
                    <p>空气温度：23 ℃</p>
                </li>

                
                <li>
                    <div class="sensorAnimation">
                        <div class="wdj-box">
                            <img src="images/wdj.png" class="first">
                            <div class="middle" style="height:65px"></div>
                            <img src="images/wdj-bg.png" class="last">
                        </div>
                    </div>
                    <p> 土壤温度：25 ℃</p>
                </li>
                <li>
                    <div class="sensorAnimation">
                        <div class="sdj-box">
                            <img src="images/sdj.png" class="first">
                            <img src="images/sdj-zz.png" style="transform: rotate(80deg);" class="last">
                        </div>
                    </div>
                    <p> 空气湿度：23%</p>
                </li>
                <li>
                    <div class="sensorAnimation">
                        <div class="sdj-box">
                            <img src="images/sdj.png" class="first">
                            <img src="images/sdj-zz.png" style="transform: rotate(120deg);" class="last">
                        </div>
                    </div>
                    <p> 土壤湿度：23%</p>
                </li>
            </ul>
        </div>
        
        <div class="cgxx-tit">
            <h3>历史信息</h3></div>
        <div class="cgxx-cnt cgxx-cnt2">
            <table class="mx-table2">
                <thead>
                <tr>
                    <th>时间</th>
                    <th>光照</th>
                    <th>二氧化碳浓度</th>
                    <th>气温温度</th>
                    <th>土壤温度</th>
                    <th>空气湿度</th>
                    <th>土壤湿度</th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>

                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>

                <tr>
                    <td>2018-07-16 19:00:01</td>
                    <td>2000lux</td>
                    <td>341.2ppm</td>
                    <td>23℃</td>
                    <td>25℃</td>
                    <td>23%</td>
                    <td>23%</td>
                </tr>
                </tbody>
            </table>
        </div>
        
        <div class="mx-page">
            <a href="#" class="btn-o">首页</a>
            <a href="#" class="btn-o">上一页</a>
            <a href="#" class="cur">1</a>
            <a href="#">2</a>
            <a href="#">3</a>
            <a href="#">4</a>
            <a href="#">5</a>
            <a href="#">6</a>
            <a href="#">7</a>
            <a href="#">8</a>
            <span>…</span>
            <a href="#">20</a>
            <a href="#" class="btn-o">下一页</a>
            <a href="#" class="btn-o">末页</a>
        </div>


    </div>
</div>


<script type="text/javascript">
    if (!window.jQuery) {
        var html =
            '<script src="js/jquery.min.js"><\/script>\n' +
            '<script src="js/jquery.scrollTo.min.js"><\/script>\n' +
            '<script src="js/jquery.bgiframe-2.1.2.js"><\/script>\n' +
            '<script src="js/jquery.ztree.all.min.js"><\/script>\n' +
            '<script src="js/layer/laydate/laydate.js"><\/script>\n' +
            '<script src="js/layer/layer.js"><\/script>\n' +
            '<script src="js/slide.js"><\/script>\n' +
            '<script src="js/common.js"><\/script>\n' +
            '<script src="js/purl.js"><\/script>\n' +
            '<script src="js/api.js"><\/script>\n' +
            '<script src="js/ui.js"><\/script>';
        document.write(html);
    }
</script>

<script>
    $(function () {
        var page = $('[page=synthesize]');
        var currentPageNo = 1;
        var queryTable = function (tableOnly) {
            var tree = page.find("#big_data_analysis_device_tree").data('z-tree');
            var selects = tree.getSelectedNodes();
            if (!selects || selects.length === 0) {
                layer.msg('请选择设备');
                return;
            }
            if (selects.length !== 1) {
                layer.msg('请选择一个设备!');
                return;
            }
            if (selects[0].oriData['tp_type'] !== 3) {
                // layer.msg('请选择一个设备!');
                return;
            }
            var deviceId = selects[0].oriData['deviceId'];
            page.find('.synDeviceName').text(selects[0].oriData['tp_name']);
            var tpId = selects[0].oriData['tp_id'];
            //不是只翻页时就图表也刷新
            if (!tableOnly)
                API.listSensorChartInfo(deviceId, tpId, function (rsp) {
                    var data = rsp.object.data;
                    if (data.length !== 1) {
                        return;
                    }
                    data = data[0];
                    var info = rsp.object.info;
                    page.find('.userInfo-more span[field]').each(function () {
                        var v;
                        var key = $(this).attr('field');
                        if ((v = info[key]) !== null) {
                            if (key === 'state') {
                                v = {"1": "运行中", "2": "不正常", "0": " "}[v] || ' ';//TODO:状态
                            }
                            $(this).text(v);
                        }
                    });
                    var unit = rsp.object.unit;
                    var chartData = [];
                    $.each(unit, function (i) {
                        var item = this;
                        if (item.chartDisplay) {
                            chartData.push({
                                fieldName: item.fieldName
                                , data: data[item.fieldName]
                                , name: item.name
                                , label: data[item.fieldName] + item.unit
                                , unit: item.unit
                            })
                        }
                    });
                    UI.renderSynChart('.cgq-list', chartData);
                });
            API.listSensorInfo(deviceId, tpId, Math.max(1, currentPageNo), function (data) {
                var unit = data.object.unit;

                var fields = [{
                    field:
                        'infoDataTime', label: '时间', render: function (data) {
                        return new Date(data).format('yyyy-MM-dd hh:mm:ss');
                    }
                }];
                var headers = ["时间"];
                $(unit).each(function (i) {
                    var f = this;
                    if (f.listDisplay === 1) {
                        headers.push(f.name);
                        fields.push({
                            field: f.fieldName
                            , label: f.name
                            , unit: f.unit
                            , render: function (value, field, rowObject, datas) {
                                return value + field.unit;
                            }
                        })
                    }
                });
                var thead = page.find('.mx-table2').find('thead').empty();
                $(headers).each(function (i) {
                    thead.append($('<th></th>').append(this))
                });
                UI.renderSimpleTable({
                    tableEl: page.find('.mx-table2'),
                    fields: fields,
                    paperEl: page.find('.mx-page'),
                    dataObjectArray: data.object.data
                    , count: data.object.count
                    , pageNo: currentPageNo
                    , totalPages: data.object.totalpage
                    , onPageItemClick: function (pageNo) {
                        currentPageNo = pageNo;
                        queryTable(true);
                    }
                });

            });
        };
        UI.renderPointTree("#big_data_analysis_device_tree", function (node) {

            if (node && node.oriData && node.oriData['tp_type'] === 3) {
                page.find("#big_data_analysis_device_tree").parents('.tree-cnt').hide();
                queryTable()
            }
        });
        var deviceProj = page.find('#big_data_analysis_device_proj');
        var deviceFrom = page.find('#big_data_analysis_device_from');
        var deviceTo = page.find('#big_data_analysis_device_to');
        page.find(".sblb>h3").click(function () {
            $(this).next().toggle();
        });
        page.find('#big_data_analysis_device_tree').on('z-tree-load', function () {
            var tree = $(this).data('z-tree');
            UI.findFirstDeviceOnTree(tree, 3, function (node) {
                if (node) {
                    queryTable();
                } else {
                    layer.msg('请选择设备');
                }
            });
        })
    })
</script>

</body>

</html>