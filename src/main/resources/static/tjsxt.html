<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>物联网-系统管理</title>
    <link rel="stylesheet" href="css/reset.min.css">
    <link rel="stylesheet" href="css/zTreeStyle/zTreeStyle.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="tjzsb">
    <form id="formId">
        <table class="">
            <tr>
                <th>在线状态</th>
                <td field="s_online" render="dict" dict="ipc_online">-</td>
            </tr>
            <tr>
                <th>IPC设备编号</th>
                <td field="mapingDeviceId">-</td>
            </tr>
            <tr>
                <th>设备名称</th>
                <td><input type="text" field="tp_name" class="text-blue"></td>
            </tr>
            <tr>
                <th>IPC设备地址</th>
                <td><input type="text" class="text-blue-sm" field="s_ip">:<input type="text" field="s_port"
                                                                                 class="text-blue-mm"></td>
            </tr>
            <tr>
                <th>设备用户名</th>
                <td><input type="text" field="s_username" class="text-blue"></td>
            </tr>
            <tr>
                <th>设备密码</th>
                <td><input type="text" field="s_password" class="text-blue"></td>
            </tr>
        </table>
    </form>
    <div class="tc mt20"><a href="javascript:;" class="btn-lg btn-df-red btn-reset">重置</a> <a href="javascript:;"
                                                                                              class="btn-lg btn-df-blue btn-save">保存</a>
    </div>
    <script type="text/javascript">if (!window.jQuery) {
        var html = '<script src="js/jquery.min.js"><\/script>\n<script src="js/jquery.scrollTo.min.js"><\/script>\n<script src="js/jquery.bgiframe-2.1.2.js"><\/script>\n<script src="js/jquery.ztree.all.min.js"><\/script>\n<script src="js/layer/laydate/laydate.js"><\/script>\n<script src="js/layer/layer.js"><\/script>\n<script src="js/slide.js"><\/script>\n<script src="js/common.js"><\/script>\n<script src="js/purl.js"><\/script>\n<script src="js/api.js"><\/script>\n<script src="js/ui.js"><\/script>';
        document.write(html)
    }</script>
    <script>var obj = {
        deviceId: "",
        pointEntity: {tp_pid: "", ip: "", port: "", tp_name: ""},
        s_nod: 12,
        s_ip: "",
        s_port: "",
        s_username: "",
        s_password: "",
        s_stream: "1",
        s_power: "2",
        ipc: {s_pwr: "0", s_pwrval: "0", deviceId: ""}
    }, editMapperFields = {
        s_ip: "s_host",
        s_port: "s_hostport",
        s_username: "username",
        s_password: "password",
        tp_name: "name"
    }, url = purl(location.href), deviceId = url.param("deviceId");
    obj.deviceId = deviceId, obj.pointEntity.port = url.param("port"), obj.pointEntity.ip = url.param("ip"), obj.pointEntity.tp_pid = url.param("tp_id");
    var tpName = url.param("name"), maxNo = parseInt(url.param("max_nod")), action = url.param("action"), updateObj = {}, load = function () {
        var t = url.param("id"), e = url.param("type") || 1;
        API.service("/getIPCProxy", {pointEntity: {}, ipc: {deviceId: deviceId, type: e}, id: t}, function (i) {
            console.log(i.object), updateObj = i.object, $("[field]").each(function () {
                var t = $(this), e = t.attr("field"), a = i.object[e];
                editMapperFields[e] && (a = i.object[editMapperFields[e]]), t.is("input") ? t.val(a) : t.attr("render") && t.attr("dict") ? t.text(API.dict[t.attr("dict")][a] || "") : t.text(a)
            })
        })
    };
    "update" === action && load(), obj.ipc.deviceId = obj.deviceId, obj.s_nod = maxNo;
    var frm = $("#formId");
    $("a.btn-reset").click(function () {
        "update" === action ? load() : frm.get(0).reset()
    });
    var doUpdate = function (t) {
        var e = {};
        for (var a in t)editMapperFields[a] ? e[editMapperFields[a]] = t[a] : e[a] = t[a];
        var i = {
            pointEntity: (e = $.extend({}, updateObj, e)).pointEntity,
            s_nod: e.s_nod,
            s_ip: e.s_host,
            s_port: e.s_hostport,
            s_username: e.username,
            s_password: e.password,
            ipc: {s_pwr: e.s_pwr, s_pwrval: e.s_pwrval, deviceId: e.deviceId},
            id: updateObj.id
        };
        API.service("/updateIPC", i, function (t) {
            layer.alert(t.msg)
        })
    };
    $("a.btn-save").click(function () {
        $("[field]").each(function () {
            obj[$(this).attr("field")] = $(this).val()
        }),
                obj.pointEntity.tp_name = obj.tp_name,
                "update" === action ? doUpdate(obj) : (obj.s_nod++, API.service("/addIPC", obj, function (t) {
                    layer.alert(t.msg)
                }))
    })</script>
</div>
</body>
</html>