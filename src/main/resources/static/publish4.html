<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>物联网-发布信息-首页资讯</title>
    <link rel="stylesheet" href="css/reset.min.css">
    <link rel="stylesheet" href="css/zTreeStyle/zTreeStyle.css">
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="mx-main" page="publish4">
    <div class="mx-handle clearfix">
        <div class="sm-title fl">首页资讯</div>
        <div class="mx-top-search fl" style="margin-left:35px"><input type="text"> <a href="#">搜索</a></div>
        <div class="sblb fr"><h3>更多</h3>
            <div class="more-cnt">
                <div class="mx-top-select" style="margin:15px auto 0;z-index:2"><h3>首页资讯一级分类<em><i></i></em></h3>
                    <dl class="mx-top-select-list">
                        <dd>首页资讯一级分类2</dd>
                        <dd>首页资讯一级分类3</dd>
                    </dl>
                </div>
                <div class="mx-top-select" style="margin:15px auto;z-index:1"><h3>首页资讯二级分类<em><i></i></em></h3>
                    <dl class="mx-top-select-list">
                        <dd>首页资讯二级分类2</dd>
                        <dd>首页资讯二级分类3</dd>
                    </dl>
                </div>
                <div class="mt20 tc"><a href="#" class="btn-lg">搜索</a></div>
            </div>
        </div>
        <a href="javascript:;" id="syzx" class="fr btn btn-default mr15">发布新信息</a></div>
    <div class="line-tit">新技术研究</div>
    <div class="mx-title"><h3>蔬菜<a href="#" class="more">了解更多&gt;</a></h3></div>
    <div class="mt20 clearfix module-box-cnt">
        <div class="module-box">
            <div class="module-info">
                <div class="img"><img src="images/pic2.png" alt=""></div>
                <h4>天知道博士</h4>
                <p>2018年7月12日</p></div>
            <h3>越瓜保护地高产栽培技术</h3>
            <p class="sm-info">
                越瓜又叫菴瓜、生瓜、梢瓜、酥瓜。为葫芦科，甜瓜属，甜瓜种中以嫩果生食的变种，一年生蔓性草本植物，主要分布于中国、日本及东南亚。中国栽培较普遍。越瓜具有很高的营养价值和药用价值，含有人体所需的糖类、维生素C、维生素B1、维生素B2、钙、磷...</p>
            <p class="tr"><a href="#">了解更多&gt;</a></p></div>
        <div class="module-box">
            <div class="module-info">
                <div class="img"><img src="images/pic3.png" alt=""></div>
                <h4>天知道博士</h4>
                <p>2018年7月12日</p></div>
            <h3>人心果栽培技术</h3>
            <p class="sm-info">
                越瓜又叫菴瓜、生瓜、梢瓜、酥瓜。为葫芦科，甜瓜属，甜瓜种中以嫩果生食的变种，一年生蔓性草本植物，主要分布于中国、日本及东南亚。中国栽培较普遍。越瓜具有很高的营养价值和药用价值，含有人体所需的糖类、维生素C、维生素B1、维生素B2、钙、磷...</p>
            <p class="tr"><a href="#">了解更多&gt;</a></p></div>
        <div class="module-box">
            <div class="module-info">
                <div class="img"><img src="images/pic4.png" alt=""></div>
                <h4>天知道博士</h4>
                <p>2018年7月12日</p></div>
            <h3>茄子剪枝再生栽培技术</h3>
            <p class="sm-info">
                越瓜又叫菴瓜、生瓜、梢瓜、酥瓜。为葫芦科，甜瓜属，甜瓜种中以嫩果生食的变种，一年生蔓性草本植物，主要分布于中国、日本及东南亚。中国栽培较普遍。越瓜具有很高的营养价值和药用价值，含有人体所需的糖类、维生素C、维生素B1、维生素B2、钙、磷...</p>
            <p class="tr"><a href="#">了解更多&gt;</a></p></div>
        <div class="module-box">
            <div class="module-info">
                <div class="img"><img src="images/pic5.png" alt=""></div>
                <h4>天知道博士</h4>
                <p>2018年7月12日</p></div>
            <h3>越瓜保护地高产栽培技术是</h3>
            <p class="sm-info">
                越瓜又叫菴瓜、生瓜、梢瓜、酥瓜。为葫芦科，甜瓜属，甜瓜种中以嫩果生食的变种，一年生蔓性草本植物，主要分布于中国、日本及东南亚。中国栽培较普遍。越瓜具有很高的营养价值和药用价值，含有人体所需的糖类、维生素C、维生素B1、维生素B2、钙、磷...</p>
            <p class="tr"><a href="#">了解更多&gt;</a></p></div>
    </div>
</div>
<div class="xxx-layer">
    <div class="clearfix">
        <div class="left-info">
            <h4>标题</h4>
            <p><input type="text" id="publish-title"></p>
            <h4>作者名</h4>
            <p><input type="text" id="publish-author"></p>
            <h4>所属一级分类</h4>
            <p><select name="" id="publish-class-sel">
                <option value=""></option>
            </select></p>
        </div>
        <div class="right-file">
            <input type="file" name="picture" accept="image/*" id="publish-file">
            <img style="width: 100%" id="cms-cover" src="images/upfile.png" alt="">
        </div>
    </div>
    <h4>文章信息</h4>
    <p><textarea name="" id="publish-content" cols="30" rows="10"></textarea></p>
    <div class="tc mt20">
        <a href="#" id="publish-frm-cancel" class="btn-lg btn-df-gray">取消</a>
        <a href="#" id="publish-frm-save" class="btn-lg btn-df-blue">保存</a>
    </div>
</div>
<script type="text/javascript">if (!window.jQuery) {
    var html = '<script src="js/jquery.min.js"><\/script>\n<script src="js/jquery.scrollTo.min.js"><\/script>\n<script src="js/jquery.bgiframe-2.1.2.js"><\/script>\n<script src="js/jquery.ztree.all.min.js"><\/script>\n<script src="js/layer/laydate/laydate.js"><\/script>\n<script src="js/layer/layer.js"><\/script>\n<script src="js/slide.js"><\/script>\n<script src="js/common.js"><\/script>\n<script src="js/purl.js"><\/script>\n<script src="js/api.js"><\/script>\n<script src="js/ui.js"><\/script>';
    document.write(html)
}</script>
<script src="js/ajaxfileupload.js"></script>

<script>
    $(function () {
        var e = $('[page="publish4"]'),
                t = e.find(".mx-top-search"),
                i = e.parents("div#main_iframe").attr("src") || location.href, n = purl(i).param("keyword");
        n && t.find("input").val(n);
        t.find("a").click(function () {
            var i = t.find("input").val();
            API.service("/listMessage", {m_type: "4", m_title: i}, function (i) {

                var t = e.find(".module-box-cnt").empty();

                $(i.object).each(function (i) {
                    UI.appendFieldTo('' +
                            '<div class="module-box">' +
                            '<div class="module-info">' +
                            '<div class="img">' +
                            '<img src="images/pic2.png" onerror="this.setAttribute(\'url\',\'images/pic2.png\');this.removeAttribute(\'onerror\')" field="m_cover" alt="" />' +
                            '</div>' +
                            '<h4 field="m_authorname">天知道博士</h4>' +
                            '<p field="m_time" date-format="yyyy年MM月dd日">2018年7月12日</p>' +
                            '</div>' +
                            '<h3 field="m_title"></h3>' +
                            '<p field="m_content" max-length="100"  class="sm-info">..</p>' +
                            '<p class="tr">' +
                            '<a href="#" onclick="showMessageDetail({m_id},4,\'查看\');return false;">了解更多&gt;</a>' +
                            '</p>' +
                            '</div>', this, t)
                })
            }, function (i) {
                e.find(".module-box-cnt").empty().html("无记录")
            })
        }).click(),
                $(".mx-top-select > h3").click(function () {
                    $(this).hasClass("on") ? ($(this).removeClass("on"),
                            $(this).next().hide()) : ($(this).addClass("on"),
                            $(this).next().show())
                }),
                $("#syzx").click(function () {
                    layer.open({
                        type: 1,
                        area: ["720px", "650px"],
                        title: "新建资讯信息",
                        content: $(".xxx-layer"),
                        skin: "mlayer",
                        success: function (e, t) {
                            var a = e.find("#publish-class-sel").empty(),
                                    s = e.find("#publish-author").val(""),
                                    i = e.find("#publish-title").val(""),
                                    n = e.find("#publish-content").val(""),
                                    l = e.find("#publish-file");

                            l.next("img").attr("src", "images/upfile.png"),

                                    l.on("change", function () {
                                        if ($(this).val()) {
                                            var data = {
                                                ckuid: sessionStorage.getItem("ckuid"),
                                                cksid: sessionStorage.getItem("cksid"),
                                                oldfile: "",
                                            };
                                            startLoading();
                                            uploadImg(data, '/addPicture', 'publish-file', 'cms-cover');
                                            stopLoading();


                                            /*var e = new FormData;
                                             e.append("ckuid", sessionStorage.getItem("ckuid")),
                                             e.append("cksid", sessionStorage.getItem("cksid")),
                                             e.append("picture", l.get(0).files[0]),
                                             e.append("oldfile", ""),
                                             startLoading(),
                                             $.ajax({
                                             url: apiPre + "/addPicture",
                                             type: "post",
                                             enctype: "multipart/form-data",
                                             processData: !1,
                                             contentType: !1,
                                             data: e,
                                             cache: !1,
                                             success: function (e) {
                                             stopLoading(), 0 === e.state ? l.next("img").attr("src", e.object).attr("value", e.object) : 2 === e.state ? layer.alert(e.msg, function () {
                                             window.parent.location.href = "./login.html"
                                             }) : layer.alert(e.msg)
                                             },
                                             error: function () {
                                             stopLoading(), layer.alert("请求失败，请重新尝试")
                                             }
                                             })*/
                                        }
                                    }),
                                    API.service("/listClass1", {c_type: 7}, function (e) {
                                        console.log("class ", e.object),
                                                $(e.object).each(function (e) {
                                                    $("<option>" + this.c_name + "</option>").attr("value", this.c_id).appendTo(a)
                                                })
                                    }),
                                    e.find("#publish-frm-save,#publish-frm-cancel").click(function (e) {
                                        if (e.preventDefault(), "publish-frm-save" === $(this).attr("id"))return s.val() ?
                                                API.service("/addMessage", {
                                                    m_authorname: s.val(),
                                                    m_class: a.val(),
                                                    m_content: n.val(),
                                                    m_title: i.val(),
                                                    m_type: "4",
                                                    m_cover: $('#cms-cover').attr("src")
                                                }, function (e) {
                                                    layer.msg(e.msg), layer.close(t), queryIt()
                                                }) : (layer.msg("请输入作者"), s.focus()), !1;
                                        layer.close(t)
                                    })
                        }
                    })
                }),
                $(".mx-checkbox").click(function (i) {
                    $(this).toggleClass("on")
                }), $(".sblb >h3").click(function () {
            $(this).next().toggle()
        })
    })</script>
</body>
</html>